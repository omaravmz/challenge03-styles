name: Pipeline Estándar Profesional
on: [push]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. HTMLHint: Revisa accesibilidad y etiquetas obsoletas
      - name: Linter de Buenas Prácticas (HTMLHint)
        run: |
          npm install -g htmlhint
          htmlhint "**/*.html" --rules "tag-pair=true,id-unique=true,src-not-empty=true,attr-value-not-empty=true,doctype-first=true,tag-self-close=false,spec-char-escape=false"

      # 3. ESLint: Validando errores reales de JS
      - name: Validador de JavaScript (ESLint)
        run: |
          npm install -g eslint
          # Creamos una configuración mínima temporal para que reconozca el navegador
          echo 'export default [{ languageOptions: { globals: { document: "readonly", window: "readonly", console: "readonly" } }, rules: { "no-undef": "error", "no-unused-vars": "error" } }];' > eslint.config.js
          npx eslint "**/*.js"

  deploy:
    needs: quality-check
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4

      - name: Deploy a GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          publish_branch: gh-pages  # Forzamos que siempre use esta rama
          force_orphan: true